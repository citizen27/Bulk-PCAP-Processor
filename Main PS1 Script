Set-ExecutionPolicy RemoteSigned -Scope CurrentUser
$folder = “<Path to the directory where the .pcap or .pcapng files are\”
$files = “*.pcapng”
$output_file = “Path to file where you would like the output written (IN .CSV FORMAT)”

#Make sure your path for Wireshark and tshark matches this

$tshark = “C:\Program Files\Wireshark\tshark”



# User Interface showing the user the output location of the files

echo “-- Analyzing Your Files --”
echo “Your results will be saved in a CSV Form here  --> $output_file
“
#User input required for this section

$prot=Read-Host "What protocol do you want to filter for (leave blank to search all protocols)"
$ip=Read-Host "What IP Address do you want to filter for (leave blank to search for all IPs)"
if($ip -ne ""){
    $ip = "ip.addr==" + $ip
    if($prot -ne ""){
        $ip = " && " + $ip
    }
}

# For loop to go through each object, and run the tshark program and options against
# that file.

# tshark options can be customized, but MOST prevalent options are preloaded.

# The $i=0 allows for cleaner formatting in the .csv file in Notepad
# as it creates a blank line, then tells you the next file you are analyzing
# then another blank line for easier interpretation of the results.

$i = 0

Get-ChildItem "C:\Users\Jake\Desktop\Practice\" | foreach-Object{
if ($i -ne 0) {
  Add-Content -Path $output_file -Value "`n$($_.FullName)`n"
}
$i++
	echo $f 
	& $tshark -r $_.FullName -T fields -e frame.number -e frame.time -e _ws.col.Protocol -e ip.src -e ip.dst -e _ws.col.Length -e _ws.col.Info -E header=y -Y "$prot $ip" >> $output_file
}
